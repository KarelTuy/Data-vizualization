<script>
  import { getContext } from "svelte";
  import { flip } from "svelte/animate";

  export let animate = {};

  const { value, valuesByKey, chartOptions } = getContext("BarChartRace");
</script>

<ol style:padding="var(--chart-padding, 0)">
  {#each $valuesByKey[$value] as datum (datum.title)}
    <li animate:flip={animate}>
      <div style="position: relative;"> <!-- Use a wrapper with relative positioning -->
        <svg
          width="100%"
          style="height: var(--bar-height, 8px); margin-top: var(--bar-margin-top, 4px); margin-bottom: var(--bar-margin-bottom, 10px);"
        >
          <!-- Display value inside the bar -->
          <rect
            height="100%"
            width="{(datum.value / $chartOptions.max) * 100}%"
            fill={datum.color || "#333"}
          />
          
          <text
            x="5" 
            y="50%" 
            fill="black"
            alignment-baseline="middle"
            style="font-size: var(--value-font-size, 10px); font-weight: var(--value-font-weight, bold); font-family: var(--value-font-family, Helvetica);"
          >
            {datum.value.toFixed(1)}{$chartOptions.unit ?? ""}
          </text>
        </svg>

        <!-- Display title to the left of the bar -->
        <div style="position: absolute; top: -20px; left: 0; text-align: left; padding-left: 5px;">
          <span style="font-size: var(--title-font-size, 12px); font-weight: var(--title-font-weight, bold); font-family: var(--title-font-family, Helvetica);">{datum.title}</span>
        </div>
      </div>
    </li>
  {/each}
</ol>
